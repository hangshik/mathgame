<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=0.90, minimum-scale=0.2, maximum-scale=5.0, user-scalable=yes">
<title>기묘한 계산기</title>
<style>
body{
  display:flex;flex-direction:column;align-items:center;
  margin:0;padding:20px;font-family:Arial,sans-serif;
}
h2{margin-bottom:10px}

/* 단계 버튼 */
#level-selector{
  display:grid;grid-template-columns:repeat(6,1fr);
  gap:6px;max-width:460px;margin-bottom:20px;
}
#level-selector button{
  height:40px;font-size:14px;border-radius:5px;
  border:1px solid #ccc;background:#fff;cursor:pointer;
}
#level-selector button.active{background:#007BFF;color:#fff;font-weight:bold;}
#level-selector button.success{background:#28a745;color:#fff;font-weight:bold;}

/* 화면 */
#display{
  max-width:420px;width:100%;
  border:2px solid #007BFF;border-radius:8px;
  padding:10px;font-size:18px;background:#f0f8ff;
}
#history{
  min-height:90px;border-top:1px dashed #aaa;
  margin-top:10px;padding-top:8px;font-size:16px;
}

/* 메시지 */
#success-msg{margin-top:12px;font-weight:bold;color:#28a745;display:none;text-align:center;font-size:20pt;}
#fail-msg{margin-top:12px;font-weight:bold;color:#dc3545;display:none;text-align:center;font-size:18pt;}

/* 버튼 */
.button-row{display:flex;gap:10px;justify-content:center;margin-top:10px;width: 500px;}
button.calc{
  width:90px;height:45px;font-size:17px;border:none;border-radius:5px;cursor:pointer;
}
button.calc:disabled{opacity:0.4;cursor:not-allowed;}
.op{background:#28A745;color:#fff;}
.util{background:#6c757d;color:#fff;}
.next{background:#007BFF;color:#fff;}
.retry{background:#dc3545;color:#fff;}

/* 설명 */
#game-desc{
  width:500px;margin-top:25px;padding-top:10px;
  border-top:1px solid #ccc;font-size:14px;color:#333;line-height:1.6;
}
</style>
</head>

<body>

<h2>기묘한 계산기</h2>

<div id="level-selector"></div>

<div id="display">
  <div id="stage-info"></div>
  <div id="current-value"></div>
  <div id="history"></div>
</div>

<div id="success-msg">성공하였습니다.</div>
<div id="fail-msg">실패하였습니다.</div>

<!-- 연산 버튼 -->
<div class="button-row">
  <button class="calc op" onclick="applyOp('+',7)">+7</button>
  <button class="calc op" onclick="applyOp('×',3)">×3</button>
  <button class="calc op" onclick="applyOp('−',11)">−11</button>
  <button class="calc op" onclick="applyOp('÷',2)">÷2</button>
</div>

<!-- 기능 버튼 (요청한 순서) -->
<div class="button-row">
  <button class="calc util" onclick="clearValue()">C</button>
  <button class="calc util" onclick="undo()">←</button>
  <button id="nextBtn" class="calc next" onclick="goNext()" disabled>다음 단계</button>
  <button id="retryBtn" class="calc retry" onclick="retry()" style="display:none;">재도전</button>
</div>

<!-- 게임 설명 -->
<div id="game-desc">
  <b>게임 설명</b><br>
  시작 숫자에서 계산 버튼을 사용하여 목표 숫자를 만들어 보세요.<br>
  각 단계마다 사용할 수 있는 버튼 횟수가 제한되어 있습니다.<br>
  제한 횟수 안에 목표 숫자를 만들면 성공, 초과하면 실패합니다.<br>
  키보드 입력도 사용할 수 있습니다.
</div>

    <div id="game-desc">
        ◈ 키보드<br>
        +7 : 숫자 1, ×3 : 숫자 2, -11 : 숫자 3, ÷2 : 숫자 4<br>
        C (초기화): C, Esc<br>
        ←: Backspace<br>
        다음 단계: Space<br>
        재도전: R
    </div>

<script>
/* -------- 단계 데이터 -------- */
const stages={
  1:{start:5,end:6,limit:2}, 2:{start:6,end:7,limit:2}, 3:{start:12,end:13,limit:2},
  4:{start:13,end:14,limit:3},5:{start:19,end:20,limit:3},6:{start:26,end:27,limit:3},
  7:{start:4,end:5,limit:4}, 8:{start:30,end:31,limit:4}, 9:{start:47,end:48,limit:4},
  10:{start:61,end:62,limit:5},11:{start:69,end:70,limit:5},12:{start:87,end:88,limit:5},
  13:{start:42,end:43,limit:6},14:{start:60,end:61,limit:6},15:{start:75,end:76,limit:6},
  16:{start:117,end:118,limit:7},17:{start:127,end:128,limit:7},18:{start:139,end:140,limit:7}
};

/* -------- 상태 -------- */
let currentStage=1, value=0, history=[];
let successStages=new Set();
let failCounts={};
let locked=false;

/* -------- UI -------- */
const levelBox=document.getElementById('level-selector');
const nextBtn=document.getElementById('nextBtn');
const retryBtn=document.getElementById('retryBtn');
const calcButtons=document.querySelectorAll('.calc.op, .calc.util');

for(let i=1;i<=18;i++){
  failCounts[i]=0;
  const b=document.createElement('button');
  b.onclick=()=>startStage(i);
  levelBox.appendChild(b);
}
updateButtons();

/* -------- 게임 로직 -------- */
function startStage(n){
  currentStage=n;
  value=stages[n].start;
  history=[];
  locked=false;
  nextBtn.disabled=true;
  retryBtn.style.display='none';
  document.getElementById('success-msg').style.display='none';
  document.getElementById('fail-msg').style.display='none';
  setCalcDisabled(false);
  updateButtons();
  render();
}

function retry(){ startStage(currentStage); }

function applyOp(op,num){
  if(locked) return;
  const before=value;
  if(op==='+') value+=num;
  if(op==='×') value*=num;
  if(op==='−') value-=num;
  if(op==='÷') value/=num;
  history.push({before,op,num,after:value});
  checkSuccess(); checkFail(); render();
}

function clearValue(){
  if(locked) return;
  value=stages[currentStage].start;
  history=[]; render();
}

function undo(){
  if(locked) return;
  if(history.length>0) value=history.pop().before;
  render();
}

function checkSuccess(){
  if(value===stages[currentStage].end){
    successStages.add(currentStage);
    locked=true; setCalcDisabled(true);
    nextBtn.disabled=(currentStage===18);
    document.getElementById('success-msg').style.display='block';
    updateButtons();
  }
}

function checkFail(){
  const limit=stages[currentStage].limit;
  if(history.length>=limit && value!==stages[currentStage].end){
    failCounts[currentStage]++;
    locked=true; setCalcDisabled(true);
    nextBtn.disabled=true;
    retryBtn.style.display='inline-block';
    document.getElementById('fail-msg').style.display='block';
    updateButtons();
  }
}

function goNext(){
  if(!nextBtn.disabled && currentStage<18) startStage(currentStage+1);
}

/* -------- 화면 -------- */
function render(){
  const s=stages[currentStage];
  document.getElementById('stage-info').innerHTML=
    `단계 ${currentStage} | 시작 ${s.start} → 목표 ${s.end} (버튼 ${s.limit}개 사용)`;
  document.getElementById('current-value').innerHTML=`현재 값 : <b>${value}</b>`;
  document.getElementById('history').innerHTML=
    history.map((h,i)=>`${i+1}. ${h.before}${h.op}${h.num} = ${h.after}`).join("<br>");
}

function updateButtons(){
  [...levelBox.children].forEach((b,i)=>{
    const n=i+1, f=failCounts[n];
    b.textContent = f>0 ? `${n}단계(${f})` : `${n}단계`;
    b.classList.toggle('active',n===currentStage);
    b.classList.toggle('success',successStages.has(n));
  });
}

function setCalcDisabled(flag){ calcButtons.forEach(b=>b.disabled=flag); }

/* -------- 키보드 입력 -------- */
document.addEventListener('keydown',(e)=>{
  if(e.repeat) return;
  const k=e.key;
  if(['1','2','3','4',' ','Backspace','Escape','c','C','r','R'].includes(k)) e.preventDefault();

  if(k==='1') applyOp('+',7);
  if(k==='2') applyOp('×',3);
  if(k==='3') applyOp('−',11);
  if(k==='4') applyOp('÷',2);
  if(k==='Backspace') undo();
  if(k==='Escape' || k==='c' || k==='C') clearValue();
  if(k===' ') goNext();
  if(k==='r' || k==='R') retry();
});

/* 시작 */
startStage(1);
</script>

</body>
</html>
