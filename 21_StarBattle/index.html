
<!-- https://www.puzzle-star-battle.com/

https://puzzleresearchroom.tistory.com/entry/Star-Battle


https://starbattle.puzzlebaron.com/ -->


<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Battle</title>
    <style>


        :root {
            --board-size: 5;
            --border-thin: 1px solid #aaa;
            --border-thick: 3px solid #333;
            --color-error: #ffebee;
            --color-active: #007bff;
            --color-hint: #ffc107;
            --color-success: #28a745;
            --color-bg-solved: #e8f5e9;
            --color-dot: #b0b8c0;
            --color-hint-active: #e3f2fd; /* íŒíŠ¸ ê°•ì¡°ìƒ‰ (ì—°í•œ íŒŒë‘) */
            --bg-color: #f8f9fa;
        }

        body {
            font-family: 'Pretendard', 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px 10px;
            color: #333;
            min-height: 100vh;
        }

        h1 { margin: 0 0 20px 0; font-size: 26px; color: #2c3e50; letter-spacing: -0.5px; }

        /* --- ë ˆë²¨ íŒ¨ë„ --- */
        .level-panel {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            width: 100%;
            max-width: 500px;
            box-sizing: border-box;
        }

        .level-group { margin-bottom: 15px; }
        .level-group:last-child { margin-bottom: 0; }
        
        .level-group-title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
            color: #666;
            display: flex;
            justify-content: space-between;
        }

        .level-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); /* ë²„íŠ¼ ë„ˆë¹„ ì•½ê°„ ì¡°ì • */
            gap: 8px;
        }

        .level-btn {
            position: relative;
            padding: 12px 0;
            background-color: #fff;
            color: #555;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .level-btn:hover { background-color: #f1f3f5; border-color: #ced4da; }
        
        /* í™œì„± ìƒíƒœ */
        .level-btn.active {
            background-color: var(--color-active);
            color: white;
            border-color: var(--color-active);
            box-shadow: 0 4px 10px rgba(0,123,255,0.3);
            z-index: 2;
        }
        
        /* í´ë¦¬ì–´ ìƒíƒœ */
        .level-btn.cleared { background-color: #28a745; border-color: #218838; color: white; }
        .level-btn.cleared:hover { background-color: #218838; }
        
        .level-btn.cleared::after {
            content: 'â˜…';
            position: absolute;
            top: 2px; right: 5px;
            font-size: 10px; color: #ffeb3b;
        }

        .level-btn.cleared.active { 
            background-color: #28a745; border-color: #28a745;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.4);
        }

        .btn-record {
            font-size: 11px;
            font-weight: normal;
            margin-top: 2px;
            color: #888;
        }
        .level-btn.cleared .btn-record,
        .level-btn.active .btn-record { color: white; opacity: 0.9; }

        /* --- ì •ë³´ ë°” --- */
        .game-info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 500px;
            margin-bottom: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            box-sizing: border-box;
        }
        .status-left { display: flex; flex-direction: column; gap: 4px; }
        .info-title { font-weight: bold; font-size: 16px; }
        .stars-left { font-size: 14px; font-weight: 600; color: var(--color-active); }
        .timer { font-size: 24px; font-family: 'Courier New', monospace; font-weight: 700; color: #333; }

        /* --- ë³´ë“œ --- */
        .game-board {
            display: none; 
            grid-template-columns: repeat(var(--board-size), minmax(0, 1fr));
            grid-template-rows: repeat(var(--board-size), minmax(0, 1fr));
            border: var(--border-thick);
            background-color: white;
            user-select: none;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1;
            margin-bottom: 25px;
            transition: background-color 0.3s ease;
            /* [ì¶”ê°€] ìì‹ ìš”ì†Œê°€ ë³´ë“œ ë„ˆë¹„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í¬ê¸°ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆê²Œ ì„¤ì • */
            container-type: inline-size;
        }

        .game-board.solved-board .cell {
            background-color: var(--color-bg-solved);
        }
        .game-board.solved-board .cell:hover {
            background-color: #dcedc8;
        }

.cell {
    position: relative;
    border-right: var(--border-thin);
    border-bottom: var(--border-thin);
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    overflow: hidden;
    font-size: calc((100cqw / var(--board-size)) * 0.7);
    cursor: pointer;
    box-sizing: border-box;
    background-color: #fff;
    transition: background-color 0.1s;
    
    /* [ìˆ˜ì • 2ë²ˆ ì ìš©] ë³„ì´ ìƒê¸¸ ë•Œ ì…€ í¬ê¸°ê°€ ë³€í•˜ì§€ ì•Šë„ë¡ ì¤„ ë†’ì´ ê³ ì • */
    line-height: 1; 
}

        .thick-right { border-right: var(--border-thick); }
        .thick-bottom { border-bottom: var(--border-thick); }

        .cell.star { 
            color: #ffeb3b; /* ë³„ ë‚´ë¶€ ìƒ‰ìƒ (ë°ì€ ë…¸ë‘) */
            
            /* ì™¸ê³½ì„  ì„¤ì • (ë‘ê»˜ 1.5px, ê²€ì€ìƒ‰) */
            -webkit-text-stroke: 1.5px black; 
            
            /* ì…ì²´ê°ì„ ìœ„í•œ ê°€ë²¼ìš´ ê·¸ë¦¼ì (ì„ íƒ ì‚¬í•­) */
            text-shadow: 2px 2px 0 rgba(0,0,0,0.15); 
        }
        
        /* (6) íšŒìƒ‰ ì› ëŒ€ì‹  ë¹¨ê°„ X */
        .cell.cross { color: transparent; }
        .cell.cross::before,
        .cell.cross::after {
            content: '';
            position: absolute;
            width: 30%; /* [ìˆ˜ì •] ì…€ ë„ˆë¹„ì˜ 50%ë¡œ ë³€ê²½ */
            height: 3px; /* í•„ìš”ì‹œ ë‘ê»˜ë„ ì¡°ì • ê°€ëŠ¥ (ì˜ˆ: calc((100cqw/var(--board-size))*0.05)) */
            background: #e53935; /* ë¹¨ê°„ìƒ‰ */
            border-radius: 2px;
        }
        .cell.cross::before { transform: rotate(45deg); }
        .cell.cross::after  { transform: rotate(-45deg); }


        /* íŒíŠ¸ í•˜ì´ë¼ì´íŠ¸ (íŒŒë€ìƒ‰) */
        .cell.hint-active {
            background-color: var(--color-hint-active) !important;
        }

        /* ì˜¤ë¥˜ í‘œì‹œ (ìµœìš°ì„ ) */
        .cell.error { background-color: var(--color-error) !important; }

        /* --- ì»¨íŠ¸ë¡¤ (ìˆ˜ì •ë¨) --- */
        .controls {
            display: flex;
            gap: 12px;
            width: 100%;
            max-width: 500px;
        }
        /* (1) ë²„íŠ¼ ê¸°ë³¸ íŒŒë€ìƒ‰ ìŠ¤íƒ€ì¼ ì ìš© */
        .btn-ctrl {
            /* ê¸°ì¡´ ê³µí†µ ìŠ¤íƒ€ì¼ ìœ ì§€ */
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: all 0.1s;

            /* [ë³€ê²½] íŒŒë€ìƒ‰ ë°°ê²½, í°ìƒ‰ ê¸€ì”¨ */
            background-color: var(--color-active); /* #007bff */
            color: white;
            border: 1px solid #0056b3;
            box-shadow: 0 4px 0 #004494; /* ì§™ì€ íŒŒë€ ê·¸ë¦¼ì */
        }

        /* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ */
        .btn-ctrl:hover {
            background-color: #0069d9;
            border-color: #004085;
        }

        /* ë²„íŠ¼ ëˆŒë €ì„ ë•Œ */
        .btn-ctrl:active { 
            transform: translateY(4px);
            box-shadow: none !important;
        }

        /* Color ë²„íŠ¼ í™œì„±í™”(ì²´í¬) ìƒíƒœ ìŠ¤íƒ€ì¼ */
        .btn-color.active {
            background-color: #0056b3 !important; /* ë” ì§„í•œ íŒŒë€ìƒ‰ */
            box-shadow: 0 2px 0 #003366 !important; /* ëˆŒë¦° ë“¯í•œ ì–•ì€ ê·¸ë¦¼ì */
            transform: translateY(2px);
        }

        /* (2) Color ë²„íŠ¼ ë‚´ë¶€ ì²´í¬ë°•ìŠ¤ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        .check-box-icon {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255, 255, 255, 0.7); /* ë°˜íˆ¬ëª… í°ìƒ‰ í…Œë‘ë¦¬ ì‚¬ê°í˜• */
            border-radius: 3px;
            position: relative;
            transition: all 0.2s;
        }

        /* í™œì„±í™” ì‹œ ì²´í¬ë°•ìŠ¤ ì±„ìš°ê¸° */
        .btn-color.active .check-box-icon {
            background-color: white;
            border-color: white;
        }

        /* í™œì„±í™” ì‹œ ì²´í¬ ëª¨ì–‘(âœ”) í‘œì‹œ */
        .btn-color.active .check-box-icon::after {
            content: 'âœ”';
            position: absolute;
            top: -4px;
            left: 0;
            font-size: 14px;
            color: #0056b3; /* íŒŒë€ìƒ‰ ì²´í¬ */
            font-weight: bold;
            line-height: 1.2;
        }


        /* --- ëª¨ë‹¬ --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 24px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 280px;
            width: 90%;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal-title { font-size: 32px; margin: 0 0 15px 0; color: #28a745; }
        .close-modal-btn {
            background: var(--color-active);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,123,255,0.4);
            margin-top: 20px;
        }
        .close-modal-btn:hover { background: #66a1e0; }

                /* [ì¶”ê°€] ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .message-area {
            display: none;       /* [ë³€ê²½] ê¸°ë³¸ì ìœ¼ë¡œ í™”ë©´ì—ì„œ ìˆ¨ê¹€ (ê³µê°„ ì°¨ì§€ X) */
            margin-bottom: 12px; /* ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚  ë•Œë§Œ ì•„ë˜ ì—¬ë°± ì ìš©ë¨ */
            font-weight: 700;
            font-size: 16px;
            text-align: center;
            color: #333;
            width: 100%;
            max-width: 500px;
        }

        
        /* ë©”ì‹œì§€ ì¢…ë¥˜ë³„ ìƒ‰ìƒ */
        .msg-success { color: #28a745; } /* ì´ˆë¡ìƒ‰ */
        .msg-error { color: #e53935; }   /* ë¹¨ê°„ìƒ‰ */


    </style>
</head>
<body>

    <h1>Star Battle</h1>

    <div class="level-panel">
        <div class="level-group">
            <div class="level-group-title"><span>5x5 (ë³„ 1ê°œ)</span> <span>ì…ë¬¸</span></div>
            <div class="level-buttons" id="lvl-5-1"></div>
        </div>
        <div class="level-group">
            <div class="level-group-title"><span>8x8 (ë³„ 1ê°œ)</span> <span>ë³´í†µ</span></div>
            <div class="level-buttons" id="lvl-8-1"></div>
        </div>
        <div class="level-group">
            <div class="level-group-title"><span>10x10 (ë³„ 2ê°œ)</span> <span>ì–´ë ¤ì›€</span></div>
            <div class="level-buttons" id="lvl-10-2"></div>
        </div>
    </div>

    <div class="game-info-bar">
        <div class="status-left">
            <div id="statusInfo" class="info-title">ë¬¸ì œ ì„ íƒ ëŒ€ê¸°ì¤‘</div>
            <div id="starsLeft" class="stars-left">ë‚¨ì€ ë³„: -</div>
        </div>
        <div class="timer" id="timer">00:00</div>
    </div>

    <div id="board" class="game-board"></div>

    <!-- [ì¶”ê°€] ë©”ì‹œì§€ê°€ í‘œì‹œë  ì˜ì—­ -->
    <div id="messageArea" class="message-area"></div>

    <div class="controls">
        <button class="btn-ctrl btn-check" onclick="checkStars()">
            í™•ì¸
        </button>

        <button class="btn-ctrl btn-hint" onclick="useHint()">
            íŒíŠ¸
        </button>

        <button class="btn-ctrl btn-reset" onclick="resetBoard()">
            ì´ˆê¸°í™”
        </button>

        <!-- [ìˆ˜ì •] classì— "active" ì¶”ê°€, aria-pressed="true"ë¡œ ë³€ê²½ -->
        <button id="btnColor" class="btn-ctrl btn-color active" aria-pressed="true" onclick="toggleColorMode()">
            <span class="check-box-icon"></span> Color
        </button>

    </div>


    <br><div style="font-size: 18px;">
      <b>[ê·œì¹™]</b><br>
      1. ê° ê°€ë¡œì¤„, ê° ì„¸ë¡œì¤„, ê·¸ë¦¬ê³  êµµì€ ì¤„ë¡œ ë‚˜ë‰œ ê° êµ¬ì—­ì— ë³„1ê°œ ë˜ëŠ” 2ê°œê°€ ë“¤ì–´ê°„ë‹¤.<br>
      2. ë³„ë“¤ì´ ì„œë¡œ ë‹¿ì•„ì„  ì•ˆ ëœë‹¤. ëŒ€ê°ì„ ìœ¼ë¡œë„ ë‹¿ì„ ìˆ˜ ì—†ë‹¤.
    </div>

    <div id="successModal" class="modal-overlay">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 class="modal-title">ğŸ‰ Clear!</h2>
            <div style="font-size: 20px; font-weight: bold; color: #555;">
                ê¸°ë¡: <span id="currentClearTime" style="color:#28a745"></span>
            </div>
            <button class="close-modal-btn" onclick="closeModal()">í™•ì¸</button>
        </div>
    </div>

    <script>
        const LEVELS = {
            '5-1': [
                {
                    id: 1, size: 5, stars: 1,
                    solution: [1,0,0,0,0, 0,0,0,1,0, 0,1,0,0,0, 0,0,0,0,1, 0,0,1,0,0],
                    regions:  [0,1,1,1,2, 0,1,1,1,2, 3,3,2,2,2, 4,4,2,2,2, 4,4,4,4,4],
                    hintOrder: [0, 1, 2,3,4,5,6,7,11, 19, 22] 
                },
                {
                    id: 2, size: 5, stars: 1,
                    solution: [0,0,0,1,0, 0,1,0,0,0, 0,0,0,0,1, 0,0,1,0,0, 1,0,0,0,0],
                    regions:  [0,0,0,1,2, 0,0,0,1,2, 3,3,3,3,2, 4,4,3,3,3, 4,4,4,4,4]
                },
                {
                    id: 3, size: 5, stars: 1,
                    solution: [0,1,0,0,0, 0,0,0,0,1, 0,0,1,0,0, 1,0,0,0,0, 0,0,0,1,0],
                    regions:  [0,0,1,1,1, 2,2,2,2,1, 2,2,2,2,1, 3,2,2,4,4, 3,3,4,4,4]
                },
                {
                    id: 4, size: 5, stars: 1,
                    solution: [0,0,0,1,0, 1,0,0,0,0, 0,0,1,0,0, 0,0,0,0,1, 0,1,0,0,0],
                    regions:  [0,0,1,1,1, 0,2,2,3,3, 2,2,2,3,3, 2,4,4,3,3, 2,4,4,4,4]
                },
                {
                    id: 5, size: 5, stars: 1,
                    solution: [0,0,1,0,0, 1,0,0,0,0, 0,0,0,0,1, 0,1,0,0,0, 0,0,0,1,0],
                    regions:  [0,0,0,0,1, 2,2,0,0,1, 2,2,2,2,1, 2,3,3,3,4, 3,3,4,4,4]
                }
            ],
            '8-1': [
                {
                    id: 1, size: 8, stars: 1,
                    solution: [
                        1,0,0,0,0,0,0,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0, 0,0,0,0,1,0,0,0, 0,0,0,0,0,0,0,1, 0,0,0,1,0,0,0,0, 0,0,0,0,0,1,0,0
                    ],
                    regions: [
                        0,0,0,0,0,0,0,0, 1,1,2,0,0,0,0,0, 1,1,2,2,0,0,3,0, 1,1,2,2,3,3,3,4, 1,1,2,2,5,3,5,4, 1,1,2,5,5,5,5,4, 1,1,2,6,6,6,7,4, 1,1,6,6,6,7,7,7
                    ]
                },
                {
                    id: 2, size: 8, stars: 1,
                    solution: [
                        0,0,0,0,0,0,0,1, 0,0,0,1,0,0,0,0, 0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0
                    ],
                    regions: [
                        0,0,0,1,1,1,2,3, 0,0,0,1,1,1,2,3, 0,0,0,0,1,1,2,2, 0,0,0,0,4,4,5,2, 0,0,0,0,4,5,5,6, 7,0,4,4,4,4,6,6, 7,7,7,7,7,4,6,6, 7,7,7,7,6,6,6,6
                    ]
                },
                {
                    id: 3, size: 8, stars: 1,
                    solution: [
                        0,0,0,0,1,0,0,0, 0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 0,0,1,0,0,0,0,0, 0,0,0,0,0,1,0,0, 1,0,0,0,0,0,0,0, 0,0,0,1,0,0,0,0
                    ],
                    regions: [
                        0,0,0,0,0,1,1,1, 2,2,0,3,3,3,3,1, 2,2,0,3,1,1,1,1, 4,2,2,3,3,1,1,1, 4,5,5,3,3,3,1,1, 4,4,5,5,3,6,6,1, 4,7,5,7,7,7,1,1, 7,7,7,7,1,1,1,1
                    ]
                },
                {
                    id: 4, size: 8, stars: 1,
                    solution: [
                        0,0,0,1,0,0,0,0, 0,0,0,0,0,1,0,0, 0,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0, 0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 0,0,0,0,1,0,0,0
                    ],
                    regions: [
                        0,0,1,1,1,2,2,2, 0,0,3,2,2,2,4,2, 0,0,3,2,2,4,4,5, 0,0,0,6,6,4,5,5, 7,7,6,6,6,4,4,5, 7,6,6,5,5,5,5,5, 7,7,6,7,7,7,7,5, 7,7,7,7,7,7,7,7
                    ]
                },
                {
                    id: 5, size: 8, stars: 1,
                    solution: [
                        0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,1, 0,0,0,1,0,0,0,0, 0,0,0,0,0,0,1,0, 0,0,1,0,0,0,0,0, 0,0,0,0,0,1,0,0, 1,0,0,0,0,0,0,0, 0,0,0,0,1,0,0,0
                    ],
                    regions: [
                        0,0,1,2,2,2,2,2, 0,1,1,2,3,3,2,4, 1,1,1,2,2,3,5,4, 1,1,3,3,3,3,5,5, 1,1,1,3,3,3,3,5, 1,1,3,3,6,3,3,5, 7,1,3,7,6,3,3,5, 7,7,7,7,6,6,6,5
                    ]
                }
            ],
            '10-2': [
                {
                    id: 1, size: 10, stars: 2,
                    solution: [
                        0,0,0,0,0,0,1,0,1,0, 1,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,1,0,0,0, 0,0,0,0,1,0,0,0,0,1, 1,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,1,0, 0,1,0,1,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,1, 0,0,0,1,0,1,0,0,0,0, 0,1,0,0,0,0,0,1,0,0
                    ],
                    regions: [
                        0,0,0,1,1,2,2,2,2,2, 0,0,0,0,1,1,1,1,1,2, 0,3,3,4,4,4,1,1,1,1, 0,0,3,4,5,4,4,1,1,6, 0,0,3,4,5,4,4,1,6,6, 4,4,4,4,5,4,1,1,6,6, 4,7,4,8,5,4,4,4,9,6, 4,7,7,8,5,4,7,7,9,9, 4,4,7,8,5,5,7,9,9,9, 4,4,7,7,7,7,7,9,9,9
                    ],
                    hintOrder: [
                        63,73,83,52,62,72,82,92,93,94,84,74,64,54,53,3,13,23,33,43,85,75,76,86,96,95,80,81,87,88,89,32,42,31,41,51,11,12,18,38,68,16,77,66,67,78,60,70,9,19,29,49,59,47,57,0,1,2,4,50,90,17,21,22,91,79,69,71,61,65,39,28,48,58,99,10,20,35,45,46,15,14,5,24,25,6,7,8,98,97,27,37,36,55,44,56,34,26,40,30
                    ]
                },
                {
                    id: 2, size: 10, stars: 2,
                    solution: [
                        1,0,0,0,1,0,0,0,0,0, 0,0,1,0,0,0,0,1,0,0, 0,0,0,0,1,0,0,0,0,1, 0,0,1,0,0,0,1,0,0,0, 1,0,0,0,0,0,0,0,0,1, 0,0,0,0,0,1,0,1,0,0, 0,1,0,1,0,0,0,0,0,0, 0,0,0,0,0,0,1,0,1,0, 0,1,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,1,0
                    ],
                    regions: [
                        0,0,0,0,1,2,2,2,2,2, 3,0,0,0,1,2,4,4,2,2, 3,0,0,0,1,2,4,2,2,2, 3,3,3,3,5,5,4,6,2,2, 3,7,7,5,5,5,4,6,6,2, 7,7,7,5,5,6,6,6,8,2, 7,7,7,5,5,5,5,8,8,8, 7,7,9,9,9,5,5,8,8,8, 7,7,9,9,9,9,5,8,8,8, 7,9,9,9,9,9,8,8,8,8
                    ],
                    hintOrder: [
                        4,14,24,3,13,23,33,34,35,25,15,5,44,54,64,74,84,94,27,37,21,41,72,82,92,91,46,36,26,45,47,6,7,66,58,11,52,8,9,48,55,56,57,65,67,68,50,51,53,59,77,87,97,96,17,16,18,28,75,85,95,86,76,42,43,63,62,73,40,49,30,31,38,39,32,22,10,20,69,79,89,99,78,88,98,90,93,83,70,71,1,0,60,80,61,81,2,12,19,29
                    ]
                },
                {
                    id: 3, size: 10, stars: 2,
                    solution: [
                        0,0,0,1,0,0,1,0,0,0, 1,0,0,0,0,0,0,0,1,0, 0,0,1,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0,1,0, 0,0,0,0,1,0,1,0,0,0, 0,0,1,0,0,0,0,0,0,1, 0,0,0,0,0,1,0,1,0,0, 0,1,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,1, 0,1,0,0,0,0,0,1,0,0
                    ],
                    regions: [
                        0,0,0,0,0,0,1,1,1,1, 2,0,0,0,0,3,3,3,1,1, 2,0,0,0,3,3,3,4,4,1, 2,2,2,5,5,3,3,4,4,4, 2,2,5,5,3,3,4,4,4,6, 2,7,5,5,5,8,4,6,4,6, 2,7,5,5,5,8,6,6,6,6, 2,7,7,5,5,8,8,9,9,6, 2,7,7,7,5,8,8,8,9,9, 2,7,7,7,7,7,9,9,9,9
                    ],
                    hintOrder: [
                        4,5,14,34,54,64,74,84,94,95,24,44,13,23,33,43,53,15,25,35,45,55,16,17,26,36,65,75,85,56,66,76,86,87,96,58,88,6,46,7,37,47,57,40,41,42,48,49,62,63,52,73,51,61,72,82,83,80,68,78,21,98,27,9,19,29,39,97,90,99,69,59,79,89,67,77,60,81,71,70,50,1,11,31,91,92,93,3,2,12,0,8,18,28,38,22,32,10,20,30
                    ]
                },
                {
                    id: 4, size: 10, stars: 2,
                    solution: [
                        0,0,0,1,0,0,0,0,0,1, 0,1,0,0,0,0,1,0,0,0, 0,0,0,1,0,0,0,0,1,0, 0,1,0,0,0,1,0,0,0,0, 0,0,0,0,0,0,0,1,0,1, 0,0,1,0,1,0,0,0,0,0, 1,0,0,0,0,0,0,0,1,0, 0,0,0,0,1,0,1,0,0,0, 1,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,1,0,1,0,0
                    ],
                    regions: [
                        0,0,0,0,0,0,1,1,1,2, 0,0,0,0,0,3,1,1,2,2, 0,0,0,3,3,3,1,2,2,2, 0,4,0,3,3,1,1,2,2,5, 6,4,0,4,3,3,5,5,5,5, 6,4,4,4,3,7,8,8,5,5, 6,6,6,3,3,7,7,8,8,5, 6,6,7,7,7,7,8,8,8,8, 6,6,7,6,7,9,9,8,8,8, 6,6,6,6,6,9,9,9,8,8
                    ],
                    hintOrder: [
                        86,96,97,87,88,98,84,94,42,40,5,15,25,45,55,65,75,66,73,74,63,64,83,85,95,90,91,92,93,99,71,81,35,24,34,44,26,36,46,54,43,53,4,14,31,41,61,62,30,20,21,22,32,33,37,38,39,23,12,13,3,2,52,51,50,56,57,58,59,60,70,80,0,10,47,48,49,69,7,17,27,67,77,76,72,78,79,82,89,68,9,8,18,19,29,28,6,1,11,16
                    ]
                },
                {
                    id: 5, size: 10, stars: 2,
                    solution: [
                        0,0,1,0,0,0,0,1,0,0, 0,0,0,0,1,0,0,0,0,1, 1,0,0,0,0,0,0,1,0,0, 0,0,0,0,0,1,0,0,0,1, 1,0,1,0,0,0,0,0,0,0, 0,0,0,0,1,0,1,0,0,0, 0,1,0,0,0,0,0,0,1,0, 0,0,0,1,0,1,0,0,0,0, 0,1,0,0,0,0,0,0,1,0, 0,0,0,1,0,0,1,0,0,0
                    ],
                    regions: [
                        0,0,0,0,0,1,1,1,1,1, 0,0,2,2,3,3,3,1,1,1, 0,2,2,2,2,3,3,4,4,4, 2,2,2,5,2,3,3,3,3,4, 2,2,2,5,6,6,6,7,7,7, 8,8,5,5,6,6,6,6,6,7, 8,8,5,5,6,6,6,7,7,7, 8,8,5,5,5,5,6,6,7,7, 8,8,9,9,9,9,9,9,7,7, 9,9,9,9,9,9,9,9,7,7
                    ],
                    hintOrder: [
                        27,16,26,36,37,38,28,18,17,35,25,24,34,44,45,46,4,5,9,8,19,29,39,48,49,59,69,79,89,99,13,12,11,10,20,30,31,21,22,23,32,33,40,41,42,50,51,52,53,43,47,0,60,70,80,90,61,71,81,62,72,82,92,91,1,2,3,75,74,64,65,66,76,86,85,84,15,55,95,14,67,77,94,54,63,73,83,93,78,68,58,57,56,96,87,97,98,88,6,7
                    ]
                }
                ,
                {
                    id: 6, size: 10, stars: 2,
                    solution: [
                        0,1,0,1,0,0,0,0,0,0, 0,0,0,0,0,1,0,0,0,1, 0,0,1,0,0,0,0,1,0,0, 1,0,0,0,0,1,0,0,0,0, 0,0,0,1,0,0,0,1,0,0, 0,1,0,0,0,0,0,0,0,1, 0,0,0,0,1,0,1,0,0,0, 1,0,0,0,0,0,0,0,1,0, 0,0,1,0,1,0,0,0,0,0, 0,0,0,0,0,0,1,0,1,0
                    ],
                    regions: [
                        0,0,0,1,1,1,1,1,1,2, 0,1,1,1,1,1,1,2,2,2, 0,3,3,3,1,1,4,4,2,2, 0,0,0,3,3,3,4,4,2,2, 5,5,5,6,7,3,4,4,8,2, 5,5,5,6,7,3,7,4,8,2, 5,5,5,6,7,7,7,4,8,8, 5,5,5,6,6,6,6,6,6,8, 5,5,9,9,9,9,9,8,8,8, 9,9,9,9,9,8,8,8,8,8
                    ]
                }
            ]
        };

        let currentLevelData = null;
        let gridState = [];
        let gameActive = false;
        const savedStates = {}; 
        const records = {};
        const hintCounts = {}; // ë ˆë²¨ë³„ íŒíŠ¸ ì‚¬ìš© íšŸìˆ˜ ì €ì¥
        let lastHintIndex = -1; // ë§ˆì§€ë§‰ìœ¼ë¡œ íŒíŠ¸ê°€ ì ìš©ëœ ì…€ ì¸ë±ìŠ¤ (íŒŒë€ìƒ‰ í•˜ì´ë¼ì´íŠ¸ìš©)

        // (5) Color ëª¨ë“œ ìƒíƒœ
        let isColorMode = true;

        // (5) êµ¬ì—­ ìƒ‰ìƒ íŒ”ë ˆíŠ¸(í•„ìš”í•˜ë©´ ëŠ˜ë ¤ë„ ë¨)
        const REGION_COLORS = [
        '#FFE0E0', '#FFE8CC', '#FFF4CC', '#E8FFCC', '#CCFFE9',
        '#CCF2FF', '#D9E7FF', '#E8D9FF', '#FFD9F2', '#E0E0E0',
        '#D7F9F1', '#F9EED7', '#E5F1FF', '#E7FFE5', '#FFF1E5'
        ];

        let startTime = 0;
        let timerInterval = null;
        let accumulatedTime = 0; 

        const boardElement = document.getElementById('board');
        const timerElement = document.getElementById('timer');
        const statusInfo = document.getElementById('statusInfo');
        const starsLeftElement = document.getElementById('starsLeft');
        const successModal = document.getElementById('successModal');

        function init() {
            createLevelButtons('lvl-5-1', LEVELS['5-1'], '5-1');
            createLevelButtons('lvl-8-1', LEVELS['8-1'], '8-1');
            createLevelButtons('lvl-10-2', LEVELS['10-2'], '10-2');
            successModal.onclick = closeModal;
        }

        function createLevelButtons(containerId, dataList, groupKey) {
            const container = document.getElementById(containerId);
            dataList.forEach((level) => {
                const btn = document.createElement('button');
                btn.className = 'level-btn';
                btn.id = `btn-${groupKey}-${level.id}`;
                // ë²„íŠ¼ ë‚´ë¶€ì— í…ìŠ¤íŠ¸ spanê³¼ ê¸°ë¡ span ë°°ì¹˜
                btn.innerHTML = `
                    <span>ë¬¸ì œ ${level.id}</span>
                    <span class="btn-record" id="rec-${groupKey}-${level.id}"></span>
                `;
                btn.onclick = () => loadLevel(level, groupKey);
                container.appendChild(btn);
            });
        }

        function saveCurrentState() {
            if (!currentLevelData) return;
            const key = `${currentLevelData.groupKey}-${currentLevelData.id}`;
            const now = Date.now();
            const currentSessionTime = gameActive ? (now - startTime) : 0;
            
            savedStates[key] = {
                grid: [...gridState],
                totalTime: accumulatedTime + currentSessionTime,
                hintCount: hintCounts[key] || 0
            };
        }

        function loadLevel(levelData, groupKey) {
            if (gameActive && currentLevelData) {
                saveCurrentState();
            }

            boardElement.style.display = 'grid';

            // [ì¶”ê°€] ë ˆë²¨ ë³€ê²½ ì‹œ ë©”ì‹œì§€ ì˜ì—­ ì§€ìš°ê¸°
            showMessage("", "");

            currentLevelData = { ...levelData, groupKey: groupKey };
            const key = `${groupKey}-${levelData.id}`;
            
            const alreadyCleared = (records[key] && records[key].length > 0);

            document.documentElement.style.setProperty('--board-size', levelData.size);
            statusInfo.innerText = `${levelData.size}x${levelData.size} (ë³„ ${levelData.stars}ê°œ) - ë¬¸ì œ ${levelData.id}`;
            
            updateButtonStyles(groupKey, levelData.id);
            successModal.style.display = 'none';
            stopTimer();

            // ë ˆë²¨ ë¡œë“œ ì‹œ ì´ì „ íŒíŠ¸ í•˜ì´ë¼ì´íŠ¸ëŠ” ì´ˆê¸°í™”
            lastHintIndex = -1;

            if (savedStates[key]) {
                gridState = [...savedStates[key].grid];
                accumulatedTime = savedStates[key].totalTime;
                hintCounts[key] = savedStates[key].hintCount || 0;
            } else {
                gridState = Array(levelData.size * levelData.size).fill(0);
                accumulatedTime = 0;
                hintCounts[key] = 0;
            }

            // ë²„íŠ¼ í…ìŠ¤íŠ¸(íŒíŠ¸ ì¹´ìš´íŠ¸) ì—…ë°ì´íŠ¸
            updateLevelBtnText(groupKey, levelData.id);

            if (alreadyCleared) {
                gameActive = false; 
                timerElement.innerText = formatTime(accumulatedTime);
                boardElement.classList.add('solved-board');
            } else {
                gameActive = true; 
                startTimer();
                boardElement.classList.remove('solved-board');
            }
            
            renderBoard();
        }

        function updateButtonStyles(currentGroup, currentId) {
            document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById(`btn-${currentGroup}-${currentId}`);
            if (activeBtn) activeBtn.classList.add('active');
        }

        function updateLevelBtnText(groupKey, levelId) {
            const key = `${groupKey}-${levelId}`;
            const btn = document.getElementById(`btn-${key}`);
            if (!btn) return;

            const textSpan = btn.querySelector('span:first-child');
            const count = hintCounts[key] || 0;

            if (count > 0) {
                textSpan.innerText = `ë¬¸ì œ ${levelId}(${count})`;
            } else {
                textSpan.innerText = `ë¬¸ì œ ${levelId}`;
            }
        }

        function resetBoard() {
            if (!currentLevelData) return;
            const key = `${currentLevelData.groupKey}-${currentLevelData.id}`;
            
            if (savedStates[key]) delete savedStates[key];
            
            gridState.fill(0);
            accumulatedTime = 0;
            hintCounts[key] = 0; 
            lastHintIndex = -1; 
            
            updateLevelBtnText(currentLevelData.groupKey, currentLevelData.id);

            // [ì¶”ê°€] ì´ˆê¸°í™” ì‹œ ë©”ì‹œì§€ ì˜ì—­ ì§€ìš°ê¸°
            showMessage("", ""); 

            gameActive = true; 
            boardElement.classList.remove('solved-board');
            
            stopTimer();
            startTimer();
            renderBoard();
        }


        function useHint() {
            if (!gameActive || !currentLevelData) return;

            const size = currentLevelData.size;
            const key = `${currentLevelData.groupKey}-${currentLevelData.id}`;
            
            // 1. ì˜¤ë‹µ(ì˜ëª» ì°ì€ ë³„) ì°¾ê¸°
            const wrongStars = [];
            for (let i = 0; i < size * size; i++) {
                // ìœ ì €ëŠ” ë³„(1)ì´ë¼ í–ˆì§€ë§Œ ì •ë‹µì€ ë³„ì´ ì•„ë‹Œ ê²½ìš°
                if (gridState[i] === 1 && currentLevelData.solution[i] !== 1) {
                    wrongStars.push(i);
                }
            }

            let pick = -1;

            if (wrongStars.length > 0) {
                // [ìš°ì„ ìˆœìœ„ 1] í‹€ë¦° ë¶€ë¶„ì´ ìˆìœ¼ë©´ ê³ ì³ì¤€ë‹¤ (X í‘œì‹œ)
                pick = wrongStars[0]; 
                gridState[pick] = 2; 
            } else {
                // [ìš°ì„ ìˆœìœ„ 2] í‹€ë¦° ë¶€ë¶„ì´ ì—†ìœ¼ë©´ ì§€ì •ëœ ìˆœì„œëŒ€ë¡œ íŒíŠ¸ë¥¼ ì¤€ë‹¤
                let foundByOrder = false;
                
                if (currentLevelData.hintOrder && currentLevelData.hintOrder.length > 0) {
                    for (let i = 0; i < currentLevelData.hintOrder.length; i++) {
                        const targetIdx = currentLevelData.hintOrder[i];
                        
                        // ì •ë‹µ ë°ì´í„° í™•ì¸ (1: ë³„, 0: ë¹ˆì¹¸)
                        const solutionVal = currentLevelData.solution[targetIdx];
                        
                        // ì •ë‹µì´ 1ì´ë©´ ë³„(1), 0ì´ë©´ X(2)ê°€ ë˜ì–´ì•¼ í•¨
                        const targetState = (solutionVal === 1) ? 1 : 2;

                        // í˜„ì¬ ìƒíƒœê°€ ì •ë‹µê³¼ ë‹¤ë¥´ë‹¤ë©´ íŒíŠ¸ë¡œ ì ìš©
                        // (ì•„ì§ ì…ë ¥ ì•ˆ í–ˆê±°ë‚˜, ì˜ëª»ëœ í‘œì‹œë¥¼ í•˜ê³  ìˆëŠ” ê²½ìš° ë“±)
                        if (gridState[targetIdx] !== targetState) {
                            pick = targetIdx;
                            gridState[pick] = targetState; 
                            foundByOrder = true;
                            break;
                        }
                    }
                }

                // [ìš°ì„ ìˆœìœ„ 3] hintOrderê°€ ì—†ê±°ë‚˜, hintOrderë¥¼ ë‹¤ ì±„ì› ëŠ”ë°ë„ ê²Œì„ì´ ì•ˆ ëë‚œ ê²½ìš°
                // ê¸°ì¡´ ë°©ì‹ëŒ€ë¡œ "ì•„ì§ ì°¾ì§€ ëª»í•œ ë³„"ì„ í•˜ë‚˜ ì•Œë ¤ì¤Œ
                if (!foundByOrder) {
                    const emptySpots = [];
                    for (let i = 0; i < size * size; i++) {
                        // ì •ë‹µì´ ë³„(1)ì¸ë° ì•„ì§ ë³„(1)ë¡œ í‘œì‹œë˜ì§€ ì•Šì€ ê³³ ì°¾ê¸°
                        if (currentLevelData.solution[i] === 1 && gridState[i] !== 1) {
                            emptySpots.push(i);
                        }
                    }

                    if (emptySpots.length === 0) {
                        showMessage("ëª¨ë“  ì •ë‹µì„ ì´ë¯¸ ì°¾ì•˜ìŠµë‹ˆë‹¤.", "success");
                        return;
                    }
                    
                    // ë‚¨ì€ ë³„ ì¤‘ ì²« ë²ˆì§¸ë¥¼ ë³´ì—¬ì¤Œ
                    pick = emptySpots[0];
                    gridState[pick] = 1;
                }
            }

            // ê³µí†µ ë¡œì§: íŒíŠ¸ ì¹´ìš´íŠ¸ ì¦ê°€ ë° í™”ë©´ ê°±ì‹ 
            hintCounts[key] = (hintCounts[key] || 0) + 1;
            updateLevelBtnText(currentLevelData.groupKey, currentLevelData.id);
            
            lastHintIndex = pick; // íŒŒë€ìƒ‰ í•˜ì´ë¼ì´íŠ¸
            renderBoard();
        }


        // [ìˆ˜ì • í›„] checkStars í•¨ìˆ˜
        function checkStars() {
            if (!currentLevelData) return;

            const size = currentLevelData.size;
            const total = size * size;

            let hasWrongStar = false;
            let hasWrongX = false;

            for (let i = 0; i < total; i++) {
                // 1. ì˜ëª»ëœ ë³„ í™•ì¸: ìœ ì € ì…ë ¥ì´ ë³„(1)ì¸ë° ì •ë‹µì´ ì•„ë‹Œ ê²½ìš°
                if (gridState[i] === 1 && currentLevelData.solution[i] !== 1) {
                    hasWrongStar = true;
                }
                // 2. ì˜ëª»ëœ X í™•ì¸: ìœ ì € ì…ë ¥ì´ X(2)ì¸ë° ì •ë‹µì´ ë³„(1)ì¸ ìë¦¬ì¸ ê²½ìš°
                if (gridState[i] === 2 && currentLevelData.solution[i] === 1) {
                    hasWrongX = true;
                }
            }

            // ë©”ì‹œì§€ ë¶„ê¸° ì²˜ë¦¬
            if (hasWrongStar && hasWrongX) {
                showMessage("ì˜ëª»ëœ ë³„ê³¼ Xê°€ ìˆìŠµë‹ˆë‹¤.", "error");
            } else if (hasWrongStar) {
                showMessage("ì˜ëª»ëœ ë³„ì´ ìˆìŠµë‹ˆë‹¤.", "error");
            } else if (hasWrongX) {
                showMessage("ì˜ëª»ëœ Xê°€ ìˆìŠµë‹ˆë‹¤.", "error");
            } else {
                showMessage("ëª¨ë“  í‘œì‹œê°€ ì •í™•í•©ë‹ˆë‹¤.", "success");
            }

            // [ë³€ê²½ë¨] ì¢Œí´ë¦­(click)ê³¼ ìš°í´ë¦­(contextmenu) ëª¨ë‘ ê°ì§€ ë“±ë¡
            setTimeout(() => {
                document.addEventListener('click', clearMessageOnce);
                document.addEventListener('contextmenu', clearMessageOnce);
            }, 0);
        }

        // [ìˆ˜ì • í›„] clearMessageOnce í•¨ìˆ˜
        function clearMessageOnce() {
            showMessage("", ""); // ë©”ì‹œì§€ ì§€ìš°ê¸°
            
            // [ë³€ê²½ë¨] ë“±ë¡í–ˆë˜ ì¢Œí´ë¦­, ìš°í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ëª¨ë‘ ì œê±°
            document.removeEventListener('click', clearMessageOnce);
            document.removeEventListener('contextmenu', clearMessageOnce);
        }


        // [ì¶”ê°€] ë©”ì‹œì§€ ì¶œë ¥ í—¬í¼ í•¨ìˆ˜
        function showMessage(text, type) {
            const msgEl = document.getElementById('messageArea');
            if (msgEl) {
                // [ì¶”ê°€ë¨] í…ìŠ¤íŠ¸ê°€ ì—†ìœ¼ë©´ ìˆ¨ê¸°ê³ (display: none), ìˆìœ¼ë©´ ë³´ì´ê²Œ(display: block) ì„¤ì •
                if (text === "") {
                    msgEl.style.display = 'none';
                } else {
                    msgEl.style.display = 'block';
                }

                msgEl.innerText = text;
                msgEl.className = 'message-area'; 
                
                if (type === 'success') msgEl.classList.add('msg-success');
                if (type === 'error') msgEl.classList.add('msg-error');
            }
        }


        function toggleColorMode() {
            isColorMode = !isColorMode;

            const btn = document.getElementById('btnColor');
            if (btn) {
                btn.classList.toggle('active', isColorMode);
                btn.setAttribute('aria-pressed', String(isColorMode));
                // ì²´í¬ ëŠë‚Œìœ¼ë¡œ í…ìŠ¤íŠ¸ë„ ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ
                // btn.innerText = isColorMode ? "Color âœ“" : "Color";
            }

            renderBoard();
        }


        function renderBoard() {
            const size = currentLevelData.size;
            const regions = currentLevelData.regions;
            
            boardElement.innerHTML = '';

            for (let i = 0; i < size * size; i++) {
                const r = Math.floor(i / size);
                const c = i % size;

                const cell = document.createElement('div');
                cell.className = 'cell';

                // (5) Color ëª¨ë“œë©´ êµ¬ì—­ë³„ë¡œ ë°°ê²½ìƒ‰ í‘œì‹œ
                if (isColorMode) {
                    const rid = regions[i];
                    const color = REGION_COLORS[rid % REGION_COLORS.length];
                    cell.style.backgroundColor = color;
                } else {
                    cell.style.backgroundColor = '';
                }


                if (c < size - 1 && regions[i] !== regions[i + 1]) cell.classList.add('thick-right');
                if (r < size - 1 && regions[i] !== regions[i + size]) cell.classList.add('thick-bottom');

                // íŒíŠ¸ë¡œ ë³€ê²½ëœ ì…€ íŒŒë€ìƒ‰ ë°°ê²½ ì ìš©
                if (i === lastHintIndex) {
                    cell.classList.add('hint-active');
                }

                if (gridState[i] === 1) {
                    cell.innerText = 'â˜…';
                    cell.classList.add('star');
                } else if (gridState[i] === 2) {
                    cell.classList.add('cross');
                }

                cell.onclick = () => { if (gameActive) handleInput(i); };
                cell.oncontextmenu = (e) => {
                    e.preventDefault();
                    if (gameActive) handleRightClick(i);
                };

                boardElement.appendChild(cell);
            }

            updateStatus();
            
            if (gameActive) {
                checkErrorsAndWin();
            }
        }


function handleInput(idx) {
    // ì‚¬ìš©ìê°€ í´ë¦­ ì‹œ íŒíŠ¸ í•˜ì´ë¼ì´íŠ¸ ì œê±°
    if (lastHintIndex !== -1) {
        lastHintIndex = -1;
    }
    // [ìˆ˜ì • 1ë²ˆ ì ìš©] ìˆœì„œ ë³€ê²½: ë¹ˆì¹¸(0) -> X(2) -> ë³„(1) -> ë¹ˆì¹¸(0)
    if (gridState[idx] === 0) {
        gridState[idx] = 2; // ë¨¼ì € X í‘œì‹œ
    } else if (gridState[idx] === 2) {
        gridState[idx] = 1; // X ë‹¤ìŒ ë³„ í‘œì‹œ
    } else {
        gridState[idx] = 0; // ë³„ ë‹¤ìŒ ë¹ˆì¹¸
    }
    
    renderBoard();
}
        function handleRightClick(idx) {
            // ì‚¬ìš©ìê°€ í´ë¦­ ì‹œ íŒíŠ¸ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            if (lastHintIndex !== -1) {
                lastHintIndex = -1;
            }

            if (gridState[idx] === 0) gridState[idx] = 2;
            else if (gridState[idx] === 2) gridState[idx] = 0;
            else if (gridState[idx] === 1) gridState[idx] = 2;
            renderBoard();
        }

        function updateStatus() {
            const size = currentLevelData.size;
            const target = currentLevelData.stars;
            const currentStars = gridState.filter(v => v === 1).length;
            const remaining = (size * target) - currentStars;

            starsLeftElement.innerText = `ë‚¨ì€ ë³„: ${remaining}ê°œ`;
            if (remaining === 0) starsLeftElement.style.color = "#28a745";
            else if (remaining < 0) starsLeftElement.style.color = "#c0392b";
            else starsLeftElement.style.color = "#007bff";
        }

        function checkErrorsAndWin() {
            if (!currentLevelData || !gameActive) return;

            const size = currentLevelData.size;
            const target = currentLevelData.stars;
            const regions = currentLevelData.regions;
            const cells = boardElement.children;
            const errors = new Set();

            for (let i = 0; i < size; i++) {
                let rowStars = [], colStars = [];
                for (let k = 0; k < size; k++) {
                    if (gridState[i * size + k] === 1) rowStars.push(i * size + k);
                    if (gridState[k * size + i] === 1) colStars.push(k * size + i);
                }
                if (rowStars.length > target) rowStars.forEach(idx => errors.add(idx));
                if (colStars.length > target) colStars.forEach(idx => errors.add(idx));
            }

            const regionMap = {};
            for (let i = 0; i < size * size; i++) {
                const rid = regions[i];
                if (!regionMap[rid]) regionMap[rid] = [];
                if (gridState[i] === 1) regionMap[rid].push(i);
            }
            for (let rid in regionMap) {
                if (regionMap[rid].length > target) regionMap[rid].forEach(idx => errors.add(idx));
            }

            for (let r = 0; r < size; r++) {
                for (let c = 0; c < size; c++) {
                    const idx = r * size + c;
                    if (gridState[idx] === 1) {
                        for (let dr = -1; dr <= 1; dr++) {
                            for (let dc = -1; dc <= 1; dc++) {
                                if (dr === 0 && dc === 0) continue;
                                const nr = r + dr, nc = c + dc;
                                if (nr >= 0 && nr < size && nc >= 0 && nc < size) {
                                    const nIdx = nr * size + nc;
                                    if (gridState[nIdx] === 1) {
                                        errors.add(idx); errors.add(nIdx);
                                    }
                                }
                            }
                        }
                    }
                }
            }

            for (let i = 0; i < cells.length; i++) {
                if (errors.has(i)) cells[i].classList.add('error');
                else cells[i].classList.remove('error');
            }

            const starCount = gridState.filter(v => v === 1).length;
            if (errors.size === 0 && starCount === (size * target)) {
                gameWin();
            }
        }

        function gameWin() {
            stopTimer();
            const now = Date.now();
            accumulatedTime += (now - startTime);
            const finalTimeStr = formatTime(accumulatedTime);

            const key = `${currentLevelData.groupKey}-${currentLevelData.id}`;
            savedStates[key] = {
                grid: [...gridState],
                totalTime: accumulatedTime,
                hintCount: hintCounts[key] || 0
            };
            
            gameActive = false;
            
            // ì„±ê³µ ì‹œ ë³´ë“œ ë°°ê²½ìƒ‰ ë³€ê²½
            boardElement.classList.add('solved-board');
            // ì„±ê³µ ì‹œ íŒíŠ¸ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            lastHintIndex = -1;
            renderBoard(); // í•˜ì´ë¼ì´íŠ¸ ì œê±° ë°˜ì˜ì„ ìœ„í•´ ë‹¤ì‹œ ë Œë”ë§

            if (!records[key]) records[key] = [];
            records[key].push(finalTimeStr);
            records[key].sort(); 
            
            const btnRecord = document.getElementById(`rec-${key}`);
            if (btnRecord) btnRecord.innerText = records[key][0];

            const btn = document.getElementById(`btn-${key}`);
            if (btn) btn.classList.add('cleared');

            showSuccessModal(finalTimeStr);
        }
        
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const m = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
            const s = String(totalSeconds % 60).padStart(2, '0');
            return `${m}:${s}`;
        }

        function showSuccessModal(currentTime) {
            document.getElementById('currentClearTime').innerText = currentTime;
            successModal.style.display = 'flex';
        }

        function closeModal() {
            successModal.style.display = 'none';
        }

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(() => {
                const now = Date.now();
                const currentMs = accumulatedTime + (now - startTime);
                timerElement.innerText = formatTime(currentMs);
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        init();
    </script>
</body>
</html>