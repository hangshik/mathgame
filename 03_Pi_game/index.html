<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>파이게임 - 연습모드 추가</title>
    <style>
      body{ font-size: 30px; }
      div { display: flex; justify-content: center; align-items: center; margin: auto; }
      .container{ display: grid; gap:10px; }
      .row { display: flex; justify-content: center; width: 100%; }

      .column {
          background-color: #DDDDDD;
          margin: -3px 2px -3px 2px;    
          border-radius: 5px;
          user-select: none;
          cursor: pointer;
          display: flex;
          justify-content: center;
          align-items: center;
          width: 70px;
          height: 70px;
          font-size: 30px;
          transition: all 0.2s; /* 부드러운 효과 추가 */
      }

      /* 비활성 버튼 스타일 (연습모드용) */
      .column.disabled {
          opacity: 0.2;
          cursor: default;
          pointer-events: none;
      }

      /* 연습모드 강조 스타일 */
      .column.active-target {
          box-shadow: 0 0 15px #60a5fa;
          border: 2px solid #3b82f6;
          background-color: #fff !important;
      }

      @media (max-width: 768px) {
          .column {
              width: 16vw;
              height: 16vw;
              font-size: 8vw;
          }
      }

      #result1 { white-space: pre-line; }
      .stage-buttons { margin: 10px; }
      .stage-buttons button {
          font-size: 20px;
          margin: 5px;
          padding: 5px 15px;
          border-radius: 10px;
          cursor: pointer;
          border: none;
      }
      .highlight { font-weight: bold; color: red; }
    </style>
</head>
<body>
    <center id="stageButtons" class="stage-buttons">
        하트: 
        <button data-mode="normal" data-hearts="0" onclick="setHearts(0)">0개</button>
        <button data-mode="normal" data-hearts="3" onclick="setHearts(3)">3개</button>
        <button data-mode="normal" data-hearts="5" onclick="setHearts(5)">5개</button>
        <button id="practiceBtn" onclick="setPracticeMode()" style="background-color: #fcd34d;">연습모드</button>
    </center>

    <center>
      <font size=6px>파이게임</font>
        <div id="heartContainer" style="font-size: 30px; text-align: left; margin-left: 20px; display: inline-block;"></div>
          <br><br>
          <div id="result1" style="font-size:30px">게임 진행 상태</div>
    </center>

    <hr/>
    <center><div id="sequenceDisplay" style="font-size:40px;">???</div></center>
    <hr/>

    <div id="area" style="font-size:30px"></div>
    
    <br><center>
    <button id="reloadButton" style="font-size:20px"> 다시 시작 </button><br>
    <font style="font-size: 22px;">◈ 키보드<br>
      0~9: 숫자 키패드<br>
    다시 시작: Space</font>
    </center>

    <script>
        document.addEventListener('contextmenu', function(e) { e.preventDefault(); });

        const pi = [3,1,4,1,5,9,2,6,5,3,5,8,9,7,9,3,2,3,8,4,6,2,6,4,3,3,8,3,2,7,9,5,0,2,8,8,4,1,9,7,1,6,9,3,9,9,3,7,5,1,0,5,8,2,0,9,7,4,9,4,4,5,9,2,3,0,7,8,1,6,4,0,6,2,8,6,2,0,8,9,9,8,6,2,8,0,3,4,8,2,5,3,4,2,1,1,7,0,6,7,9,8,2,1,4,8,0,8,6,5,1,3,2,8,2,3,0,6,6,4,7,0,9,3,8,4,4,6,0,9,5,5,0,5,8,2,2,3,1,7,2,5,3,5,9,4,0,8,1,2,8,4,8,1,1,1,7,4,5,0,2,8,4,1,0,2,7,0,1,9,3,8,5,2,1,1,0,5,5,5,9,6,4,4,6,2,2,9,4,8,9,5,4,9,3,0,3,8,1,9,6,4,4,2,8,8,1,0,9,7,5,6,6,5,9,3,3,4,4,6,1,2,8,4,7,5,6,4,8,2,3,3,7,8,6,7,8,3,1,6,5,2,7,1,2,0,1,9,0,9,1,4,5,6,4,8,5,6,6,9,2,3,4,6,0,3,4,4,1,8,1,5,9,8,1,3,6,2,9,7,7,4,7,7,1,3,0,9,9,6,0,5,1,8,7,0,7,2,1,1,3,4,9,9,9,9,9,9,8,3,7,2,9,7,8,0,4,9,9,5,1,0,5,9,7,3,1,7,3,2,8,1,6,0,9,6,3,1,8,5,9,5,0,2,4,4,5,9,4,5,5,3,4,6,9,0,8,3,0,2,6,4,2,5,2,2,3,0,8,2,5,3,3,4,4,6,8,5,0,3,5,2,6,1,9,3,1,1,8,8,1,7,1,0,1,0,0,0,3,1,3,7,8,3,8,7,5,2,8,8,6,5,8,7,5,3,3,2,0,8,3,8,1,4,2,0,6,1,7,1,7,7,6,6,9,1,4,7,3,0,3,5,9,8,2,5,3,4,9,0,4,2,8,7,5,5,4,6,8,7,3,1,1,5,9,5,6,2,8,6,3,8,8,2,3,5,3,7,8,7,5,9,3,7,5,1,9,5,7,7,8,0,5,3,2,1,7,1,2,2,6,8,0,6,6,1,3,0,0,1,9,2,7,8,7,6,6,1,1,1,9,5,9,0,9,2,1,6,4,2,0,1,9,8,9];

        let hearts = 0;
        let selectedHearts = 0;
        let isPracticeMode = false; // 연습모드 여부
        let stop = true;
        let count = 0;
        let inputSequence = [];

        function updateHearts() {
            let heartDisplay = isPracticeMode ? "♾️ 연습중" : "";
            if (!isPracticeMode) {
                for (let i = 0; i < hearts; i++) heartDisplay += "❤️ ";
            }
            document.getElementById("heartContainer").innerHTML = heartDisplay;
        }

        function setHearts(n) {
            isPracticeMode = false;
            selectedHearts = n;
            resetGame();
        }

        function setPracticeMode() {
            isPracticeMode = true;
            selectedHearts = 0;
            resetGame();
        }

        function resetGame() {
            hearts = selectedHearts;
            stop = true;
            count = 0;
            inputSequence = [];
            updateHearts();
            updateSequenceDisplay();
            main(); 
            updatePracticeUI(); // 연습모드 UI 초기화
            
            result1.textContent = isPracticeMode ? "연습모드입니다.\n하이라이트된 숫자를 누르세요." : "파이게임을 시작합니다.\n 3으로 시작하세요.";
            result1.style.color = "black";

            // 버튼 상태 업데이트
            document.querySelectorAll("#stageButtons button").forEach(btn => {
                btn.style.backgroundColor = "";
                btn.style.color = "";
            });
            if (isPracticeMode) {
                document.getElementById("practiceBtn").style.backgroundColor = "#fbbf24";
            } else {
                document.querySelectorAll("#stageButtons button").forEach(btn => {
                   if (btn.dataset.mode === "normal" && parseInt(btn.dataset.hearts) === selectedHearts) {
                       btn.style.backgroundColor = "#60a5fa";
                       btn.style.color = "white";
                   }
                });
            }
        }

        // 연습모드 시 버튼 활성/비활성 처리
        function updatePracticeUI() {
            if (!isPracticeMode) return;
            
            const nextCorrect = pi[count];
            for (let i = 0; i <= 9; i++) {
                const btn = document.getElementById(i);
                if (i === nextCorrect) {
                    btn.classList.remove("disabled");
                    btn.classList.add("active-target");
                } else {
                    btn.classList.add("disabled");
                    btn.classList.remove("active-target");
                }
            }
        }

        function updateSequenceDisplay() {
            if (inputSequence.length === 0) {
                sequenceDisplay.innerHTML = "???";
                return;
            }
            let displaySeq = inputSequence.slice(-7);
            let html = "";
            displaySeq.forEach((num, idx) => {
                html += (idx === displaySeq.length - 1) ? `<span class="highlight">${num}</span>` : num;
            });
            sequenceDisplay.innerHTML = html + "???";
        }

        function clickbt(nn) {
            if (!stop) return;
            
            // 연습모드일 때 틀린 숫자 클릭 방어
            if (isPracticeMode && nn !== pi[count]) return;

            if (nn == pi[count]) {
                inputSequence.push(nn);
                updateSequenceDisplay();
                count++;
                result1.textContent = (isPracticeMode ? "연습 중... \n" : "게임 진행중\n") + count + "번째 성공하셨습니다.";
                result1.style.color = "blue";
                
                const btn = document.getElementById(nn);
                const originalColor = btn.style.backgroundColor;
                btn.style.backgroundColor = "green";
                
                setTimeout(() => {
                    resultreset();
                    updatePracticeUI(); // 다음 숫자 강조
                }, 50);
            } else {
                hearts--;
                updateHearts();
                document.getElementById(nn).style.backgroundColor = "gray";
                if (hearts <= 0) {
                    result1.textContent = "게임 끝\n[" + count + "번째까지 성공하셨습니다.]";
                    result1.style.color = "red";
                    stop = false;
                }
            }
        }

        function resultreset() {
            for (let i = 0; i <= 9; i++) {
                document.getElementById(i).style.backgroundColor = "#dddddd";
            }
        }

        function main() {
            let tag = "<div class='container'>";
            for (let j = 0; j < 2; j++) { 
              tag += "<div class='row'>";
              for (let i = 0; i < 5; i++) {
                let num = (i + j*5 + 1) % 10;
                tag += `<div class='column' id='${num}' onclick='clickbt(${num})'>${num}</div>`;
              }
              tag += "</div>";
            }
            tag += "</div>";
            area.innerHTML = tag;
        }

        document.addEventListener("keydown", (e) => {
            if (e.key >= "0" && e.key <= "9") {
                clickbt(parseInt(e.key));
            } else if (e.code === "Space") {
                document.getElementById("reloadButton").click();
            }
        });

        document.getElementById("reloadButton").addEventListener("click", resetGame);
        window.onload = () => { resetGame(); };
    </script>
</body>
</html>