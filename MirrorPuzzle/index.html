<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>단계별 격자</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #f0f0f0;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      font-family: sans-serif;
    }
    .stage-buttons {
      margin-bottom: 20px;
    }
    .stage-buttons button {
      margin: 4px;
      width: 68px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      border: 1px solid #888;
      background: white;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .stage-buttons button:hover {
      background: #ddd;
    }
    .stage-buttons button.selected {
      background: #007BFF;
      color: white;
      border: 1px solid #007BFF;
    }
    .stage-buttons button.completed {
      background: #28a745;
      color: white;
      border: 1px solid #28a745;
    }
    .grid {
      display: grid;
      gap: 0;
      margin-bottom: 20px;
    }
    .cell {
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      font-size: 20px;
    }
    .bordered {
      border: 1px solid #ccc;
    }
    .button-cell {
      border: none;
      background: none;
      cursor: pointer;
      width: 100%;
      height: 100%;
      position: relative;
    }
    .shape {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .circle {
      border: 3px solid green;
      border-radius: 50%;
      background: transparent;
      width: 30px;
      height: 30px;
      margin: auto;
    }
    .slash::before, .backslash::before {
      content: "";
      position: absolute;
      width: 3px;
      height: 141%;
      background: red;
      top: 50%;
      left: 50%;
      transform-origin: center;
    }
    .slash::before {
      transform: translate(-50%, -50%) rotate(-45deg);
    }
    .backslash::before {
      transform: translate(-50%, -50%) rotate(45deg);
    }
    .result {
      font-size: 20px;
      font-weight: bold;
      margin: 10px;
    }
    .buttons {
      margin-top: 10px;
    }
    .buttons button {
      margin: 0 5px;
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #888;
      background: white;
      border-radius: 4px;
      transition: all 0.2s;
    }
    .buttons button:hover {
      background: #ddd;
    }
  </style>
</head>
<body>
  <div class="stage-buttons" id="stageButtons"></div>
  <div class="grid" id="grid"></div>
  <div class="buttons">
    <button id="resetBtn">처음으로</button>
    <button id="checkBtn">정답확인</button>
  </div>
  <div id="result" class="result"></div>

  <script>
    const stageButtons = document.getElementById('stageButtons');
    const grid = document.getElementById('grid');
    const result = document.getElementById('result');
    const resetBtn = document.getElementById('resetBtn');
    const checkBtn = document.getElementById('checkBtn');

    let buttons = [];
    let currentData = [];
    let gridSize = 5;
    let innerSize = 3;
    let currentStage = 1;
    const completedStages = new Set();

    const dataSets = [
      [[,,0,,],[,0,1,2,],[,0,1,2,],[,0,0,0,],[,3,2,1,]],
      [[11,12,13,14,15],[16,1,0,2,17],[18,0,1,0,19],[20,2,0,1,21],[22,23,24,25,26]],
      [[31,32,33,34,35],[36,0,2,1,37],[38,2,0,1,39],[40,1,2,0,41],[42,43,44,45,46]],
      [[51,52,53,54,55],[56,1,1,0,57],[58,0,2,1,59],[60,1,0,2,61],[62,63,64,65,66]],
      [[71,72,73,74,75],[76,2,0,1,77],[78,1,2,0,79],[80,0,1,2,81],[82,83,84,85,86]],
      [[1,2,3,4,5,6],[7,0,1,2,1,8],[9,1,0,2,0,10],[11,2,1,0,2,12],[13,0,1,2,0,14],[15,16,17,18,19,20]],
      [[21,22,23,24,25,26],[27,1,0,2,1,28],[29,2,1,0,2,30],[31,0,1,2,0,32],[33,1,0,2,1,34],[35,36,37,38,39,40]],
      [[41,42,43,44,45,46],[47,2,1,0,2,48],[49,0,2,1,0,50],[51,1,0,2,1,52],[53,2,1,0,2,54],[55,56,57,58,59,60]],
      [[1,2,3,4,5,6,7],[8,0,1,2,0,1,9],[10,2,1,0,2,0,11],[12,0,2,1,0,2,13],[14,1,0,2,1,0,15],[16,2,1,0,2,1,17],[18,19,20,21,22,23,24]],
      [[25,26,27,28,29,30,31],[32,1,0,2,1,0,33],[34,0,2,1,0,2,35],[36,2,1,0,2,1,37],[38,1,0,2,1,0,39],[40,0,2,1,0,2,41],[42,43,44,45,46,47,48]]
    ];

    for (let i = 1; i <= 26; i++) {
      const btn = document.createElement('button');
      btn.textContent = `${i}단계`;
      btn.dataset.stage = i;
      btn.addEventListener('click', () => loadStage(i));
      stageButtons.appendChild(btn);

      // 5단계마다 줄바꿈 추가
      if (i % 5 === 0 && i !== 26) {
        stageButtons.appendChild(document.createElement('br'));
      }
    }

    function loadStage(stage) {
      currentStage = stage;
      gridSize = stage <= 5 ? 5 : stage <= 8 ? 6 : 7;
      innerSize = stage <= 5 ? 3 : stage <= 8 ? 4 : 5;
      currentData = dataSets[stage - 1];
      renderGrid();
      updateStageButtons();
      result.textContent = '';
    }

    function renderGrid() {
      grid.innerHTML = '';
      buttons = [];
      grid.style.gridTemplateColumns = `repeat(${gridSize}, 60px)`;
      grid.style.gridTemplateRows = `repeat(${gridSize}, 60px)`;

      for (let row = 0; row < gridSize; row++) {
        for (let col = 0; col < gridSize; col++) {
          const isCenter = row >= 1 && row <= innerSize && col >= 1 && col <= innerSize;
          const value = currentData[row][col];
          const cell = document.createElement('div');
          cell.className = 'cell';

          if (isCenter) {
            cell.classList.add('bordered');
            const btn = document.createElement('button');
            btn.className = 'button-cell';
            btn.dataset.state = 0;
            const shape = document.createElement('div');
            shape.className = 'shape circle';
            btn.appendChild(shape);

            btn.addEventListener('click', () => {
              let current = parseInt(btn.dataset.state);
              if (current === 0) current = 2;
              else if (current === 2) current = 1;
              else current = 0;
              btn.dataset.state = current;
              shape.className = `shape ${getShapeClass(current)}`;
            });

            cell.appendChild(btn);
            buttons.push({ row, col, btn, shape });
          } else {
            cell.textContent = value;
          }

          grid.appendChild(cell);
        }
      }
    }

    function getShapeClass(state) {
      return state === 0 ? 'circle' : state === 1 ? 'slash' : 'backslash';
    }

    resetBtn.addEventListener('click', () => {
      buttons.forEach(({ btn, shape }) => {
        btn.dataset.state = 0;
        shape.className = 'shape circle';
      });
      result.textContent = '';
    });

    checkBtn.addEventListener('click', () => {
      let correct = 0;
      buttons.forEach(({ row, col, btn }) => {
        const answer = currentData[row][col];
        const state = parseInt(btn.dataset.state);
        if (answer === state) correct++;
      });
      const total = buttons.length;
      if (correct === total) {
        result.textContent = '정답입니다!';
        result.style.color = 'green';
        completedStages.add(currentStage);
      } else {
        result.textContent = `틀렸습니다! 현재 ${correct}/${total} 개 맞았습니다.`;
        result.style.color = 'red';
      }
      updateStageButtons();
    });

    function updateStageButtons() {
      document.querySelectorAll('.stage-buttons button').forEach(btn => {
        btn.classList.remove('selected', 'completed');
        if (parseInt(btn.dataset.stage) === currentStage) {
          btn.classList.add('selected');
        }
        if (completedStages.has(parseInt(btn.dataset.stage))) {
          btn.classList.add('completed');
        }
      });
    }

    loadStage(1);
  </script>
</body>
</html>
